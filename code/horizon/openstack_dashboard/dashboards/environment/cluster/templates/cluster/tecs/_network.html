{% load i18n %}
{% load context_selection %}

<script src="{{ STATIC_URL }}dashboard/bootstrapValidator.js"></script>
<script type='text/javascript' charset='utf-8'>

function ShowParamByNetWorkType(){
    var type = $("#sel_add_plane_type").val();
    $(".form_add_plane .Optional").hide();
    $(".form_add_plane ."+type).show();
    $(".form_add_plane").data('bootstrapValidator').resetForm();
}

function ShowAddNetPlaneDialog(){
    $("#sel_add_plane_type").val("STORAGE");
    if ($("#physnet1cluster_seg_type_vxlan").attr("checked") == "checked"){
        $("#sel_add_plane_type option[value='DATAPLANE']").hide();
    }
    else{
        $("#sel_add_plane_type option[value='DATAPLANE']").show();
    }
    ShowParamByNetWorkType();
    $(".form_add_plane").find("input").val("");
    $(".form_add_plane").find("textarea").val("");
    $('#modalAddNetPlane').modal({
        backdrop: "static"
    });
}

function CloseDialog(){
    $(".form_add_plane").data('bootstrapValidator').resetForm();
}

function DeleteNetPlanePanel(net_plane_name){
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'cidr');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'gateway');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'vlan');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'vlanstart');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'vlanend');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'ip_start');
    $('.form-net-plane').bootstrapValidator('removeField', net_plane_name + 'ip_end');
    $(".panel_" + net_plane_name).remove();
}

function CallBackDeleteNetPlane(net_plane){
    DeleteNetPlanePanel(net_plane["name"]);
}

function DeleteNetPlane(id, name){
    var title = '{% trans "Confirm to delete" %}';
    var body = interpolate(gettext("You have selected %s. "), [name]);
    body += gettext("Please confirm your selection. ");
    body += '{% trans "This action cannot be undone." %}';
    var action = '{% trans "Delete" %}'
    modal = horizon.modals.create(title, body, action)
    modal.modal();
    modal.find('.btn-primary').attr("href", "javascript:void(0)");
    modal.find('.btn-primary').click(function (evt) {
        var cluster_id = $("#input-network-cluster-id").val();
        if (id != "") {
            net_plane = {
                "id": id,
                "name": name
            }
            var url = "/dashboard/environment/cluster/" + cluster_id + "/delete_net_plane";
            do_post(url, JSON.stringify(net_plane), CallBackDeleteNetPlane);
        }
        else
        {
            DeleteNetPlanePanel(name);
        }
        modal.modal('hide')
    });
}

function AddNetPlane(){
    var cluster_id = $("#input-network-cluster-id").val();
    $(".form_add_plane").data('bootstrapValidator').validate();
    if (!$(".form_add_plane").data('bootstrapValidator').isValid())
        return;
    var network_type = $("#sel_add_plane_type").val();
    var ip_ranges = new Array();
    $('div.add_plane_ip_range').each(function(){
        var start = $(this).find("input[name='add_plane_ip_start']").val();
        var end   = $(this).find("input[name='add_plane_ip_end']").val();
        if (start != "" && end != ""){
            var ip_range = {
                "start":start,
                "end":end};
            ip_ranges.push(ip_range);
        }
    });
    var cidr = $("#txt_add_plane_cidr").val();
    var vlan_start = $("#txt_add_plane_vlan_start").val();
    vlan_start = vlan_start == "" ? "0": vlan_start;
    var vlan_end = $("#txt_add_plane_vlan_end").val();
    vlan_end = vlan_end == "" ? "0": vlan_end;
    var vlan_id = $("#txt_add_plane_vlan").val();
    vlan_id = vlan_id == "" ? "": vlan_id;
    var net_plane = {
        "name": $("#txt_add_plane_name").val(),
        "network_type":$("#sel_add_plane_type").val(),
        "cidr":cidr,
        "gateway":$("#txt_add_plane_gateway").val(),
        "ip_ranges":ip_ranges,
        "vlan_start":vlan_start,
        "vlan_end":vlan_end,
        "vlan_id":vlan_id,
        "capability":$("#sel_add_plane_capability").val(),
        "description":$("#txt_add_plane_desc").val()
    }
    if (network_type == "DATAPLANE"){
        var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
        net_plane["segmentation_type"] = segmentation_type;
    }
    if (cluster_id != ""){
        var url = "/dashboard/environment/cluster/" + cluster_id + "/add_net_plane/";
        do_post(url, JSON.stringify(net_plane), add_netplane_html);
    }
    else{
        net_plane["id"] = ""
        add_netplane_html(net_plane);
    }
}

function AddPhysnet1NewField(){
    var net_name = "physnet1";
    $('.form-net-plane')
    .bootstrapValidator('addField', net_name + 'cidr', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vxlan"){
                        return checkCIDR(value);
                    }
                    return true;
                },
                message: "{% trans 'CIDR format is wrong,correct format is:xxx.xxx.xxx.xxx/xx' %}"
            }
        }
    })
    .bootstrapValidator('addField', net_name + 'gateway', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vxlan"){
                        return checkGateway(value);
                    }
                    return true;
                },
                message: "{% trans 'gateway format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
            }
        }
    })
    .bootstrapValidator('addField', net_name + 'vlanstart', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vlan"){
                        if (value != "" && /^\d+$/.test(value)){
                            return true;
                        }
                        return false;
                    }
                    return true;
                },
                message: "{% trans 'VLAN starting number can not be empty and must be digit' %}"
            }
        }
    })
    .bootstrapValidator('addField', net_name + 'vlanend', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vlan"){
                        if (value != "" && /^\d+$/.test(value)){
                          return true;
                        }
                        return false;
                    }
                    return true;
                },
                message: "{% trans 'VLAN ending number can not be empty and must be digit' %}"
            }
        }
    })
    .bootstrapValidator('addField', net_name + 'ip_start', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vxlan"){
                        return checkIP(value);
                    }
                    return true;
                },
                message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
            }
        }
    })
    .bootstrapValidator('addField', net_name + 'ip_end', {
        validators: {
            callback: {
                callback: function(value, validator) {
                    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                    if (segmentation_type == "vxlan"){
                        return checkIP(value);
                    }
                    return true;
                },
                message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
            }
        }
    });
}

function AddNewField(net_name){
    $('.form-net-plane')
    .bootstrapValidator('addField', net_name + 'cidr', {
      validators: {
        callback: {
          callback: checkCIDR,
          message: "{% trans 'CIDR format is wrong,correct format is:xxx.xxx.xxx.xxx/xx' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'gateway', {
      validators: {
        callback: {
          callback: checkGateway,
          message: "{% trans 'gateway format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'vlan', {
      validators: {
        callback: {
          callback: checkVlanId,
          message: "{% trans 'VLAN ID number must be digit greater than 0' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'vlanstart', {
      validators: {
        notEmpty: {
          message: "{% trans 'VLAN starting number can not be null' %}"
        },
        digits: {
          message: "{% trans 'VLAN starting number must be digit' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'vlanend', {
      validators: {
        notEmpty: {
          message: "{% trans 'VLAN ending number can not be null' %}"
        },
        digits: {
          message: "{% trans 'VLAN ending number must be digit' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'ip_start', {
      validators: {
        callback: {
          callback: checkIP,
          message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
        }
      }
    })
    .bootstrapValidator('addField', net_name + 'ip_end', {
      validators: {
        callback: {
          callback: checkIP,
          message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
        }
      }
    });
}

function add_netplane_html(anet){
  html =  '<div class="panel panel-default panel_' + anet.name +'" style="border-left: 3px solid rgb(119, 119, 119)">';
  html += ' <div class="panel-heading" role="tab" id="heading' + anet.name + '">';
  html += '     <h3 class="panel-title">';
  html += '         <a role="button" class="net_plane" data-toggle="collapse" data-parent="#selector" href="#collapse' + anet.name + '" data-net-plane-name="' + anet.name + '">';
  html +=               '{% trans "Name" %}:' + anet.name;
  html += '         </a>';
  html += '         <a href="javascript:void(0);" class="pull-right" onclick="DeleteNetPlane(' + "'" + anet.id + "'," + "'" + anet.name + "'" + ')" title="{% trans 'Delete Cluster' %}">';
  html += '             <span class="glyphicon glyphicon-trash"></span>';
  html += '         </a>';
  html += '     </h3>';

  html += ' </div>';
  html += ' <div id="collapse'+ anet.name +'" class="panel-collapse collapse role="tabpanel" aria-labelledby="heading'+ anet.name + '">';
  html += '     <div class="panel-body">';
  if (anet.network_type == "DATAPLANE"){
  html += ' <div style="clear:both" class="form-group" id="'+ anet.name +'segment_type_block">';
  html += '     <label class="col-sm-4 control-label" style="text-align:right;">{% trans "Segment type" %}</label>';
  html += '     <div class="col-sm-2">';
  html += '         <label class="radio-inline">';
  html += '             <input type="radio" id="'+ anet.name +'cluster_seg_type_vlan" name="'+ anet.name +'cluster_seg_type" class="'+ anet.name +'cluster_seg_type" value="vlan" checked disabled>vlan';
  html += '         </label>';
  html += '         <label class="radio-inline">';
  html += '             <input type="radio" id="'+ anet.name +'cluster_seg_type_vxlan" name="'+ anet.name +'cluster_seg_type" class="'+ anet.name +'cluster_seg_type" value="vlan" disabled>vxlan';
  html += '         </label>';
  html += '     </div>';
  html += ' </div>';
  }
  html += '         <div style="clear:both" class="form-group" id="'+ anet.name +'cidr_block">';
  html += '             <label for="'+ anet.name +'cidr" class="col-sm-4 control-label" style="text-align:right;">CIDR</label>';
  html += '             <div class="col-sm-4">';
  html += '                 <input name="'+ anet.name +'cidr" type="text" class="form-control" id="'+ anet.name +'cidr" placeholder="CIDR" value="'+ anet.cidr +'">';
  html += '             </div>';
  html += '         </div>';
  html += '         <div style="clear:both" class="form-group" id="'+ anet.name +'gateway_block">';
  html += '             <label for="'+ anet.name +'gateway" class="col-sm-4 control-label" style="text-align:right;">{% trans "gateway" %}</label>';
  html += '             <div class="col-sm-4">';
  html += '                 <input name="'+ anet.name +'gateway" type="text" class="form-control" id="'+ anet.name +'gateway" placeholder="{% trans "gateway" %}" value="'+ anet.gateway + '">';
  html += '             </div>';
  html += '         </div>';
  html += '         <div>';
  html += '             <input id="'+ anet.name +'cluster_id" type="hidden" value="">';
  html += '             <input id="'+ anet.name +'countipranges" type="hidden" value="1">';
  html += '             <input id="'+ anet.name +'netid" type="hidden" value="'+ anet.id + '">';
  html += '             <input id="'+ anet.name +'network_type" type="hidden" value="' + anet.network_type + '">';
  html += '         </div>';
  html += '         <div style="clear:both" class="'+ anet.name +'ip_ranges" id="'+ anet.name +'iprange_block">';
  if (anet.ip_ranges.length > 0){
    for(var i=0; i<anet.ip_ranges.length; i++){
  html += '             <div id="' + anet.name + 'ip_range_index' + i.toString() + '" class="form-group ip_range">';
  html += '                 <label class="col-sm-4 control-label" style="text-align:right;">';
  if(i == 0){
    html += '{% trans "IP range" %}'};
  html += '</label>';
  html += '                 <div class="col-sm-6">';
  html += '                     <div class="row">';
  html += '                         <div class="col-xs-4">';
  html += '                             <input name="'+ anet.name +'ip_start" type="text" class="form-control ip_start" placeholder="{% trans 'IP starting address' %}" value="'+ anet.ip_ranges[i].start + '"/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="text-align:center;">';
  html += '                             <span class="glyphicon glyphicon-minus"></span>';
  html += '                         </div>';
  html += '                         <div class="col-xs-4">';
  html += '                             <input name="'+ anet.name +'ip_end" type="text" class="form-control ip_end" placeholder="{% trans 'IP ending address' %}" value="'+  anet.ip_ranges[i].end + '"/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="">';
      if(i==0){
  html += '                             <a href="javascript:void(0);" class="'+ anet.name +'add_ip_range" net-name="'+ anet.name +'" data-name-start="'+ anet.name +'ip_start" data-name-end="'+ anet.name +'ip_end">';
  html += '                                 <span class="glyphicon glyphicon-plus"></span>';
  html += '                             </a>';
      }else{
  html += '                             <a href="javascript:void(0);" net-name="'+ anet.name +'" data-name-start="'+ anet.name +'ip_start" data-name-end="'+ anet.name +'ip_end" class="'+ anet.name +'delete_ip_range" delete_object="'+ anet.name +'ip_range_index' + i + '"><span class="glyphicon glyphicon-minus"></span></a>';
      }
  html += '                         </div>';
  html += '                     </div>';
  html += '                 </div>';
  html += '             </div>';
    }
  }
  else {
  html += '             <div id="' + anet.name + 'ip_range_index0' + '" class="form-group ip_range">';
  html += '                 <label class="col-sm-4 control-label" style="text-align:right;">{% trans "IP range" %}</label>';
  html += '                 <div class="col-sm-6">';
  html += '                     <div class="row">';
  html += '                         <div class="col-xs-4">';
  html += '                             <input name="'+ anet.name +'ip_start" type="text" class="form-control ip_start" placeholder="{% trans "IP starting address" %}" value=""/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="text-align:center;">';
  html += '                             <span class="glyphicon glyphicon-minus"></span>';
  html += '                         </div>';
  html += '                         <div class="col-xs-4">';
  html += '                             <input name="'+ anet.name +'ip_end" type="text" class="form-control ip_end" placeholder="{% trans "IP ending address" %}" value=""/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="">';
  html += '                             <a href="javascript:void(0);" class="'+ anet.name +'add_ip_range" net-name="'+ anet.name +'" data-name-start="'+ anet.name +'ip_start" data-name-end="'+ anet.name +'ip_end">';
  html += '                                 <span class="glyphicon glyphicon-plus"></span>';
  html += '                             </a>';
  html += '                         </div>';
  html += '                     </div>';
  html += '                 </div>';
  html += '             </div>';
  }
  html += '             <div class="form-group" id="'+ anet.name +'template" style="display:none;clear:both;">';
  html += '                 <label class="col-sm-4 control-label" style="text-align:right;"></label>';
  html += '                 <div class="col-sm-6">';
  html += '                     <div class="row">';
  html += '                         <div class="col-xs-4">';
  html += '                             <input type="text" class="form-control ip_start" placeholder="{% trans "IP starting address" %}" value=""/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="text-align:center;">';
  html += '                             <span class="glyphicon glyphicon-minus"></span>';
  html += '                         </div>';
  html += '                         <div class="col-xs-4">';
  html += '                             <input type="text" class="form-control ip_end" placeholder="{% trans "IP ending address" %}" value=""/>';
  html += '                         </div>';
  html += '                         <div class="col-xs-1" style="">';
  html += '                             <a href="javascript:void(0);" class="delete_dynamic_ip_range"><span class="glyphicon glyphicon-minus"></span></a>';
  html += '                         </div>';
  html += '                     </div>';
  html += '                 </div>';
  html += '             </div>';
  html += '         </div>';

  html += '         <div style="clear:both" class="form-group" id="'+ anet.name +'vlan_block">';
  html += '             <label for="'+ anet.name +'vlan" class="col-sm-4 control-label" style="text-align:right;">{% trans "VLAN" %}</label>';
  html += '             <div class="col-sm-4">';
  html += '                 <input name="'+ anet.name +'vlan" type="text" class="form-control" id="'+ anet.name +'vlan" placeholder="{% trans "VLAN" %}" value="'+ anet.vlan_id + '">';
  html += '             </div>';
  html += '         </div>';
        
  html += '         <div style="clear:both" class="form-group" id="'+ anet.name +'vlanrange_block">';
  html += '             <label for="'+ anet.name +'vlanstart" class="col-sm-4 control-label" style="text-align:right;">{% trans "VLAN range" %}</label>';
  html += '             <div class="col-sm-6">';
  html += '                 <div class="row">';
  html += '                     <div class="col-xs-4">';
  html += '                         <input name="'+ anet.name +'vlanstart" type="text" class="form-control" id="'+ anet.name +'vlanstart" placeholder="{% trans "VLAN starting number" %}" value="'+ anet.vlan_start + '"/>';
  html += '                     </div>';
  html += '                     <div class="col-xs-1" style="text-align:center;">';
  html += '                         <span class="glyphicon glyphicon-minus"></span>';
  html += '                     </div>';
  html += '                     <div class="col-xs-4">';
  html += '                         <input name="'+ anet.name +'vlanend" type="text" class="form-control" id="'+ anet.name +'vlanend" placeholder="{% trans "VLAN ending number" %}" value="'+ anet.vlan_end + '"/>';
  html += '                     </div>';
  html += '                 </div>';
  html += '             </div>';
  html += '         </div>';

  html += '         <div style="clear:both" class="form-group hide" id="'+ anet.name +'capability_block">';
  html += '             <label for="'+ anet.name +'capability" class="col-sm-4 control-label" style="text-align:right;">{% trans "capability" %}</label>';
  html += '             <div class="col-sm-4">';
  html += '                 <select class="form-control" name="capability" id="'+ anet.name +'capability">';
  html += '                     <option value="None">{% trans "Default" %}</option>';
  html += '                     <option value="high">{% trans "high" %}</option>';
  html += '                     <option value="low">{% trans "low" %}</option>';
  html += '                 </select>';
  html += '             </div>';
  html += '         </div>';

  html += '         <div style="clear:both" class="form-group" id="'+ anet.name +'description_block">';
  html += '             <label for="'+ anet.name +'description" class="col-sm-4 control-label" style="text-align:right;">{% trans "description" %}</label>';
  html += '             <div class="col-sm-4">';
  html += '                 <textarea class="form-control" id="'+ anet.name +'description" placeholder="{% trans "description" %}" rows="3">'+ anet.description + '</textarea>';
  html += '             </div>';
  html += '         </div>';
  html += '     </div>';
  html += ' </div>';
  html += '</div>';

  var $panel_network_type = $("#panel_network_type_" + anet.network_type);
  if ($panel_network_type.length == 0){
      var $panel_network_type = $('<div class="panel panel-default" id="panel_network_type_' + anet.network_type + '" style="border-left: 3px solid rgb(119, 119, 119)"></div>');
      var $panel_heading = $('<div class="panel-heading" role="tab" id="heading_network_type_' + anet.network_type + '"></div>');
      var $h3 = $('<h3 class="panel-title"></h3>');
      var $link = $('<a role="button" data-toggle="collapse" data-parent="#selector" href="#collapse_network_type_' + anet.network_type + '">' + '{% trans "Network Type" %}:' +anet.network_type + '</a>');
      $h3.append($link);
      $panel_heading.append($h3);
      $panel_network_type.append($panel_heading);
      var $panel_collapse = $('<div id="collapse_network_type_' + anet.network_type + '" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading_network_type_' + anet.network_type + '"></div>');
      var $panel_body = $('<div class="panel-body"></div>');
      var $panel_group = $('<div class="panel-group" id="' + anet.network_type + 'accordion" role="tablist" aria-multiselectable="true"></div>')
      $panel_body.append($panel_group);
      $panel_collapse.append($panel_body);
      $panel_network_type.append($panel_collapse);
      console.log($panel_network_type.html());
      $("#accordion").append($panel_network_type);
  }
  var $accordion = $("#" + anet.network_type + "accordion");
  $accordion.append(html);

  // Add new field
  AddNewField(anet.name);
  $("#"+ anet.name + "capability").val(anet.capability);
  //bind event
  $("." + anet.name + "add_ip_range").on('click', AddIPRange);
  $("." + anet.name + "delete_ip_range").on('click', DeleteIPRange);

  if(anet.network_type == "DATAPLANE") {
      $("#" + anet.name + "cidr_block").hide();
      $("#" + anet.name + "gateway_block").hide();
      $("#" + anet.name + "iprange_block").hide();
      $("#" + anet.name + "vlan_block").hide();
  }
  else if (anet.network_type == "HEARTBEAT"){
      $("#" + anet.name + "gateway_block").hide();
      $("#" + anet.name + "vlanrange_block").hide();
  }
  else if(anet.network_type == "STORAGE") {
      $("#" + anet.name + "vlanrange_block").hide();
  }
  $('#modalAddNetPlane').modal('hide');
}

function reload_network_window(){
    var cluster_id = $("#input-network-cluster-id").val();
    if ($("#input-is-wizard").val() == "0"){
        window.location = '/dashboard/environment/cluster/'+ cluster_id + '/overview?tab=net-plane-tab';
    }
    else{
        window.location = "/dashboard/environment/deploy/" + cluster_id + "/network_next";
    }
}

function get_net_plane_info(){
    var net_planes = new Array();
    $(".net_plane").each(function(){
        var name = $.trim($(this).attr("data-net-plane-name"));
        var ip_ranges = new Array();
        $('.'+name+'ip_ranges div.ip_range').each(function(){
            var start = $(this).find("input.ip_start").val();
            var end   = $(this).find("input.ip_end").val();
            if (start != "" && end != ""){
                var ip_range = {
                                "start":start,
                                "end":end
                                };
                ip_ranges.push(ip_range);
            }
        });
        var vlan_id = null;
        if ($("#"+name+"vlan").val() != ""){
            vlan_id = parseInt($("#"+name+"vlan").val(), 10);
        }
        var network_type = $("#"+name+"network_type").val();
        var net_plane = {
            "cluster_id":$("#"+name+"cluster_id").val(),
            "name":name,
            "cidr":$("#"+name+"cidr").val(),
            "gateway":$("#"+name+"gateway").val(),
            "network_type":network_type,
            "ip_ranges":ip_ranges,
            "vlan_start":parseInt($("#"+name+"vlanstart").val(), 10),
            "vlan_end":parseInt($("#"+name+"vlanend").val(), 10),
            "vlan_id":vlan_id,
            "id":$("#"+name+"netid").val(),
            "capability":$("#"+name+"capability").val(),
            "description":$("#"+name+"description").val()
        }
        if (network_type == "DATAPLANE"){
            var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
            net_plane["segmentation_type"] = segmentation_type;
            if (segmentation_type == "vxlan" && name == "physnet1"){
                net_plane["vni_start"] = $("#vxlan_range_start").val();
                net_plane["vni_end"] = $("#vxlan_range_end").val();
            }
            filter_param_list = [
                {"type":"vlan", "params": ["cidr", "gateway", "ip_ranges", "vlan_id"]},
                {"type":"vxlan", "params": ["vlan_start", "vlan_end", "vlan_id"]}]
            for (var i = 0;i < filter_param_list.length;i++){
                if (filter_param_list[i]["type"] == segmentation_type){
                    var filter_params = filter_param_list[i]["params"];
                    for (var j = 0;j < filter_params.length;j++){
                        delete net_plane[filter_params[j]]
                    }
                }
            }
        }
        net_planes.push(net_plane);
    })

    return net_planes;
}

function checkCIDR(cidr){
    if (cidr == ""){
        return true;
    }
    var reg = new RegExp("^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])(\/([0-9]|[1-2][0-9]|3[0-2]))$");
    if (!reg.test(cidr)){
        return false;
    }
    return true;
}

function checkAddPlaneCIDR(cidr){
    var type = $("#sel_add_plane_type").val();
    var $div_cidr = $("#txt_add_plane_cidr").parent().parent();
    if ($div_cidr.hasClass(type))
    {
        var reg = new RegExp("^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])(\/([0-9]|[1-2][0-9]|3[0-2]))$");
        if (!reg.test(cidr)){
            return false;
        }
    }
    return true;
}

function checkGateway(gateway){
    if (gateway == "None" || gateway == ""){
        return true;
    }
    var reg = new RegExp("^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$");
    if (!reg.test(gateway)){
        return false;
    }
    return true;
}

function checkIP(str){
    if (str === "")
        return true;
    var reg = new RegExp("^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$");
    if (!reg.test(str))
        return false;
    return true;
}

function checkPhysnet1IP(str){
    var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
    if (segmentation_type == "vxlan"){
        return checkIP(str);
    }
    return true;
}

function checkVLANRange(str){
    var type = $("#sel_add_plane_type").val();
    if (type == "DATAPLANE")
    {
        return str != "" && !isNaN(str);
    }
    return true;
}

function checkVlanId(vlan_id){
    if (vlan_id == "None" || vlan_id == ""){
        return true;
    }
    else{
        var reg = new RegExp("^[1-9][0-9]*$");
        if (!reg.test(vlan_id)){
            return false;
        }
    }
    return true;
}

function checkAddPlaneVLANID(vlan_id){
    var type = $("#sel_add_plane_type").val();
    if (vlan_id == "None" || vlan_id == ""){
        return true;
    }
    else{
        var $div_vlan = $("#txt_add_plane_vlan").parent().parent();
        if ($div_vlan.hasClass(type)){
            var reg = new RegExp("^[1-9][0-9]*$");
            return reg.test(vlan_id)
        }
    }
    return true;
}

function DeleteIPRange(){
    var fieldStartName = $(this).attr('data-name-start');
    var fieldEndName   = $(this).attr('data-name-end');
    $('.form-net-plane').bootstrapValidator('removeField', fieldStartName);
    $('.form-net-plane').bootstrapValidator('removeField', fieldEndName);
    $("#" + $(this).attr("delete_object")).remove();
}

function _AddIPRange(callback, $that){
    var net_name  = $that.attr('net-name');
        $template = $('#'+net_name+'template');
    // find max index
    var ip_ranges = $('.'+ net_name +'ip_ranges div.ip_range');
    var max_index = 0;
    ip_ranges.each(function(){
        var id = $(this).attr("id");
        var index = id.split(net_name + "ip_range_index")[1];
        if (index > max_index){
          max_index = index;
        }
    });
    max_index += 1;
    // add ip range
    var $newRow   = $template.clone().removeAttr('id').addClass('ip_range').insertBefore($template).show();
    // add attribute
    $newRow.attr("id", net_name + "ip_range_index" + max_index.toString());
    $newRow
        .find('a.delete_dynamic_ip_range')
            .attr('net-name', net_name)
            .attr('delete_object', net_name + "ip_range_index" + max_index.toString())
            .end();

    // Set the label and field name
    var fieldStartName = $that.attr('data-name-start');
    var fieldEndName   = $that.attr('data-name-end');
    $newRow
        .find('input:first')
            .attr('name', fieldStartName)
            .end()
        .find('input:last')
            .attr('name', fieldEndName)
            .end()
        .on('click', '.delete_dynamic_ip_range', function() {
            // Remove field when clicking the Remove button
            $('.form-net-plane').bootstrapValidator('removeField', fieldStartName);
            $('.form-net-plane').bootstrapValidator('removeField', fieldEndName);
            // Remove element
            $("#" + $(this).attr("delete_object")).remove();
        });

    // Add new field
    $('.form-net-plane').bootstrapValidator('addField', fieldStartName, {
        validators: {
            callback: {
                callback: callback,
                message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
            }
        }
    });
    $('.form-net-plane').bootstrapValidator('addField', fieldEndName, {
        validators: {
            callback: {
                callback: callback,
                message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
            }
        }
    });
}

function AddPhysnet1IPRange(){
    _AddIPRange(checkPhysnet1IP, $(this));
}

function AddIPRange(){
    _AddIPRange(checkIP, $(this));
}

function ShowSegmentType(type){
    var hide_list = [
        {
            "type":"vlan", 
            "list":["vxlan_range", "cidr", "gateway", "iprange", "vlan"]
        },
        {
           "type":"vxlan", 
            "list":["vlan", "vlanrange"] 
        }];
    var allow_show_list = ["vxlan_range", "cidr", "gateway", "iprange", "vlan", "vlanrange"];
    for (var i = 0;i < allow_show_list.length;i++){
        $("#physnet1" + allow_show_list[i] + "_block").show();
    }
    for (var i = 0;i < hide_list.length;i++){
        var hide_info = hide_list[i];
        if (type == hide_info["type"]){
            for (var j = 0;j < hide_info["list"].length;j++){
                $("#physnet1" + hide_info["list"][j] + "_block").hide();
            }
        }
    }
}

function ClickSegmentType(e){
    var $panel_data_planes = $("#DATAPLANEaccordion div.panel-default");
    if ($panel_data_planes.length > 1){
        horizon.alert('error', "Already have multiple DATAPLANE type net planes, No support modify segment type,please delete the non physnet1 network plane RE modification");
        e.preventDefault();
        return;
    }
    var type = $(this).val();
    ShowSegmentType(type);
}

function NetplaneClick(){
    ha_info = get_ha_role_values();
    if (ha_info["glance_disk_location"] == "share" 
      || ha_info["db_disk_location"] == "share"
      || ha_info["db_disk_location"] == "sharecluster"
      || ha_info["mongodb_disk_location"] == "share"
      || ha_info["dbbackup_disk_location"] == "share"
      || ha_info["cinder_volume_array"].length > 0) {
        $("#panel_network_type_STORAGE").show();
    }
    else {
        $("#panel_network_type_STORAGE").hide();
    }
}

$(function(){
    $(".add_ip_range").on('click', AddIPRange);
    //删除原有IP范围
    $(".delete_ip_range").on('click', DeleteIPRange);
    $(".physnet1add_ip_range").on('click', AddPhysnet1IPRange);
    $(".physnet1delete_ip_range").on('click', DeleteIPRange);
    $(".physnet1cluster_seg_type").on('click', ClickSegmentType);
    $(".physnet1cluster_seg_type").each(function(){
        if ($(this).attr("checked") == 'checked'){
            ShowSegmentType($(this).val());
            return false;
        }
    })

    $('a[href="#cluster_netplane"]').on('click', NetplaneClick);

    //添加网络平面-动态添加IP范围表单验证
    $(".add_plane_ip_range_link").on('click', function() {
        var $that     = $(this),
            $template = $('#add_plane_ip_range_template'),
            $newRow   = $template.clone().removeAttr('id').addClass('add_plane_ip_range').insertBefore($template).show();

        // Set the label and field name
        var fieldStartName = $that.attr('data-name-start');
        var fieldEndName   = $that.attr('data-name-end');
        $newRow
            .find('input:first')
                .attr('name', fieldStartName)
                .end()
            .find('input:last')
                .attr('name', fieldEndName)
                .end()
            .on('click', '.delete_add_plane_ip_range', function() {
                    // Remove field when clicking the Remove button
                    $('.form_add_plane').bootstrapValidator('removeField', fieldStartName);
                    $('.form_add_plane').bootstrapValidator('removeField', fieldEndName);
                    // Remove element
                    $(this).parent().parent().parent().parent().remove();
                });

        // Add new field
        $('.form_add_plane').bootstrapValidator('addField', fieldStartName, {
            validators: {
                callback: {
                    callback: checkIP,
                    message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                }
            }
        });
        $('.form_add_plane').bootstrapValidator('addField', fieldEndName, {
            validators: {
                callback: {
                    callback: checkIP,
                    message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                }
            }
        });
    });

    $(".form_add_plane").bootstrapValidator({
        message: 'This value is not valid',
        excluded: ':disabled',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            add_plane_name: {
                validators: {
                    notEmpty: {
                        message: "{% trans 'Name can not be empty' %}"
                    },
                    regexp: {
                        regexp: '^[a-zA-Z][a-zA-Z0-9_]{3,15}$',
                        message: '{% trans "Name must begin with letters,and consist of numbers,letters or underscores. The length of name is 4 to 16." %}'
                    }
                }
            },
            add_plane_cidr: {
                validators: {
                    callback: {
                        callback: checkAddPlaneCIDR,
                        message: "{% trans 'CIDR format is wrong,correct format is:xxx.xxx.xxx.xxx/xx' %}"
                    }
                }
            },
            add_plane_gateway: {
                validators: {
                    callback: {
                        callback: checkGateway,
                        message: "{% trans 'gateway format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            },
            add_plane_vlan: {
                validators: {
                    callback: {
                        callback: checkAddPlaneVLANID,
                        message: "{% trans 'VLAN ID number must be digit greater than 0' %}"
                    }
                }
            },
            add_plane_vlan_start: {
                validators: {
                    callback: {
                        callback: checkVLANRange,
                        message: "{% trans 'VLAN starting number can not be empty and must be digit' %}"
                    }
                }
            },
            add_plane_vlan_end: {
                validators: {
                    callback: {
                        callback: checkVLANRange,
                        message: "{% trans 'VLAN ending number can not be empty and must be digit' %}"
                    }
                }
            },
            add_plane_ip_start:{
                validators: {
                    callback: {
                        callback: checkIP,
                        message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            },
            add_plane_ip_end:{
                validators: {
                    callback: {
                        callback: checkIP,
                        message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            }
        }
    })

    $('.form-net-plane').bootstrapValidator({
        message: 'This value is not valid',
        excluded: ':disabled',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            vxlan_range_start: {
                validators: {
                    callback: {
                        callback: function(value, validator) {
                            var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                            if (segmentation_type == "vxlan"){
                                var str = $("#vxlan_range_start").val();
                                if ((str == "") || (isNaN(str)))
                                    return false;
                                var value = parseInt(str, 10);
                                if (value < 1 || value > 16777215)
                                    return false;
                            }
                            return true;
                        },
                        message: '{% trans "Range: 1-16777215" %}'
                    }
                }
            },
            vxlan_range_end: {
                validators: {
                    callback: {
                        callback: function(value, validator) {
                            var segmentation_type = $('input:radio[name="physnet1cluster_seg_type"]:checked').val();
                            if (segmentation_type == "vxlan"){
                                var str = $("#vxlan_range_end").val();
                                if ((str == "") || (isNaN(str)))
                                    return false;
                                var value = parseInt(str, 10);
                                if (value < 1 || value > 16777215)
                                    return false;
                            }
                            return true;
                        },
                        message: '{% trans "Range: 1-16777215" %}'
                    }
                }
            },
            cidr: {
                validators: {
                    callback: {
                        callback: checkCIDR,
                        message: "{% trans 'CIDR format is wrong,correct format is:xxx.xxx.xxx.xxx/xx' %}"
                    }
                }
            },
            gateway: {
                validators: {
                    callback: {
                        callback: checkGateway,
                        message: "{% trans 'gateway format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            },
            vlan: {
                validators: {
                    callback: {
                        callback: checkVlanId,
                        message: "{% trans 'VLAN ID number must be digit greater than 0' %}"
                    }
                }
            },
            vlanstart: {
                validators: {
                    notEmpty: {
                        message: "{% trans 'VLAN starting number can not be null' %}"
                    },
                    digits: {
                        message: "{% trans 'VLAN starting number must be digit' %}"
                    }
                }
            },
            vlanend: {
                validators: {
                    notEmpty: {
                        message: "{% trans 'VLAN ending number can not be null' %}"
                    },
                    digits: {
                        message: "{% trans 'VLAN ending number must be digit' %}"
                    }
                }
            },
            ip_start:{
                validators: {
                    callback: {
                        callback: checkIP,
                        message: "{% trans 'IP starting address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            },
            ip_end:{
                validators: {
                    callback: {
                        callback: checkIP,
                        message: "{% trans 'IP ending address format is wrong,correct format is:xxx.xxx.xxx.xxx' %}"
                    }
                }
            }
        }
    }).on('error.form.bv', function(e) {
        // Active the panel element containing the first invalid element
        var $form         = $(e.target),
            validator     = $form.data('bootstrapValidator'),
            $invalidField = validator.getInvalidFields().eq(0),
            $collapse     = $invalidField.parents('.collapse');

        $collapse.collapse('show');
    });
    //add new field for physnet1
    AddPhysnet1NewField();

    {% for anet in network.networks %}
        {% for net_plane in anet.net_planes%}
        if("{{ anet.network_type }}" != "DATAPLANE")
        {
            $("#{{ net_plane.name }}capability_block").hide();
            $("#{{ net_plane.name }}capability").val("{{ net_plane.capability}}");
        }
        else
        {
            $("#{{ net_plane.name }}capability_block").hide();
        }
        
        if(("{{ anet.network_type }}" == "STORAGE") || ("{{ anet.network_type }}" == "PUBLICAPI") ||
           ("{{ anet.network_type }}" == "MANAGEMENT") || ("{{net_plane.name}}" == "DEPLOYMENT"))
        {
            $("#{{ net_plane.name }}vlanrange_block").hide();
        }

        if("{{ anet.network_type }}" == "HEARTBEAT")
        {
            $("#{{ net_plane.name }}gateway_block").hide();
            $("#{{ net_plane.name }}vlanrange_block").hide();
        }

        if("{{ anet.network_type }}" == "DATAPLANE" && "{{ net_plane.name }}" != "physnet1")
        {
            $("#{{ net_plane.name }}cidr_block").hide();
            $("#{{ net_plane.name }}gateway_block").hide();
            $("#{{ net_plane.name }}iprange_block").hide();
            $("#{{ net_plane.name }}vlan_block").hide();
        }

        if("{{ anet.network_type }}" == "EXTERNAL")
        {
            $("#{{ net_plane.name }}vlan_block").hide();
        }

        if("{{segment_type}}" == "flat")
        {
            $("#{{ net_plane.name }}vlanrange_block").hide();
            $("#{{ net_plane.name }}vlan_block").hide();
        }
        {% endfor %}
    {% endfor %}
});
</script>

<div class="pull-right">
    <button type="button" class="btn btn-primary" onclick="ShowAddNetPlaneDialog()">
        {% trans "Add Net Plane" %}
    </button>
</div>
<form class="form-horizontal form-net-plane" style="margin-top:15px;">
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        {% for anet in network.networks %}
        <div class="panel panel-default" id="panel_network_type_{{anet.network_type}}" style="border-left: 3px solid {{ forloop.counter0|get_color }}">
            <div class="panel-heading" role="tab" id="heading_network_type_{{ anet.network_type }}">
                <h3 class="panel-title">
                    <a role="button" data-toggle="collapse" data-parent="#selector" href="#collapse_network_type_{{ anet.network_type }}"
                       {% if forloop.first %}
                       aria-expanded="true"
                       {% else %}
                       aria-expanded="false"
                       {% endif %} aria-controls="collapse_network_type_{{ anet.network_type }}">
                    {% trans 'Network Type' %}:{{ anet.network_type }}
                    </a>
                </h3>
            </div>
            <div id="collapse_network_type_{{ anet.network_type }}" class="panel-collapse collapse {% if forloop.first %} in {% endif %}" role="tabpanel" aria-labelledby="heading_network_type_{{ anet.network_type }}">
                <div class="panel-body">
                    <div class="panel-group" id="{{ anet.network_type }}accordion" role="tablist" aria-multiselectable="true">
                        {% for net_plane in anet.net_planes %}
                        <div class="panel panel-default panel_{{net_plane.name}}" style="border-left: 3px solid {{ forloop.counter0|get_color }}">
                            <div class="panel-heading" role="tab" id="heading{{ net_plane.name }}">
                                <h3 class="panel-title">
                                    <a role="button" class="net_plane" data-toggle="collapse" data-parent="#selector" href="#collapse{{ net_plane.name }}"
                                       {% if forloop.first %}
                                       aria-expanded="true"
                                       {% else %}
                                       aria-expanded="false"
                                       {% endif %} aria-controls="collapse{{ net_plane.name }}" data-net-plane-name="{{ net_plane.name }}">
                                    {% trans 'Name' %}:{{ net_plane.name }}
                                    </a>
                                    {% ifequal net_plane.type "custom"%}
                                    <a href="#" class="pull-right" onclick="DeleteNetPlane('{{net_plane.id}}', '{{net_plane.name}}')" title="{% trans 'Delete Net Plane' %}">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                    {% endifequal %}
                                </h3>
                            </div>
                            <div id="collapse{{ net_plane.name }}" class="panel-collapse collapse {% if forloop.first %} in {% endif %}" role="tabpanel" aria-labelledby="heading{{ net_plane.name }}">
                                <div class="panel-body">
                                    {% ifequal anet.network_type "DATAPLANE" %}
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}segment_type_block">
                                        <label class="col-sm-4 control-label" style="text-align:right;">{% trans 'Segment type' %}</label>
                                        <div class="col-sm-2">
                                            <label class="radio-inline">
                                                <input type="radio" id="{{ net_plane.name }}cluster_seg_type_vlan" name="{{ net_plane.name }}cluster_seg_type" class="{{ net_plane.name }}cluster_seg_type" value="vlan" checked {% ifnotequal net_plane.name "physnet1" %}disabled{% endifnotequal%}>vlan
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" id="{{ net_plane.name }}cluster_seg_type_vxlan" name="{{ net_plane.name }}cluster_seg_type" class="{{ net_plane.name }}cluster_seg_type" value="vxlan" {% ifequal net_plane.segmentation_type "vxlan" %} checked {% endifequal %} {% ifnotequal net_plane.name "physnet1" %}disabled{% endifnotequal%}>vxlan
                                            </label>
                                        </div>
                                        {% ifequal net_plane.name "physnet1" %}
                                        <div class="col-sm-2">
                                            <a href="javascript:void(0);" title="{% trans '1.A cluster can only config a segment type;2.vxlan segment type can have a  DATAPLANE type net plane;3.Already have multiple DATAPLANE type net planes, No support modify segment type,please delete the non physnet1 network plane RE modification' %}">
                                                <span class="glyphicon glyphicon-question-sign"></span>
                                            </a>
                                        </div>
                                        {% endifequal %}
                                    </div>
                                        {% ifequal net_plane.name "physnet1" %}
                                    <div style="clear:both" class="form-group {% ifequal segment_type 'vxlan' %}hide{% endifequal %}" id="{{ net_plane.name }}vxlan_range_block">
                                        <label class="col-sm-4 control-label" style="text-align:right;">{% trans 'VXLAN Range' %}</label>
                                        <div class="col-sm-6">
                                            <div class="row">
                                                <div class="col-xs-4">
                                                    <input name="vxlan_range_start" type="text" class="form-control" id="vxlan_range_start" placeholder="{% trans 'Start number' %}" value="{{ net_plane.vni_start|default_if_none:'' }}"/>
                                                </div>
                                                <div class="col-xs-1" style="text-align:center;">
                                                    <span class="glyphicon glyphicon-minus"></span>
                                                </div>
                                                <div class="col-xs-4">
                                                    <input name="vxlan_range_end" type="text" class="form-control" id="vxlan_range_end" placeholder="{% trans 'End number' %}" value="{{ net_plane.vni_end|default_if_none:'' }}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        {% endifequal %}
                                    {% endifequal %}
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}cidr_block">
                                        <label for="{{ net_plane.name }}cidr" class="col-sm-4 control-label" style="text-align:right;">CIDR</label>
                                        <div class="col-sm-4">
                                            <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}cidr" type="text" class="form-control" id="{{ net_plane.name }}cidr" placeholder="CIDR" value="{{ net_plane.cidr|default_if_none:''}}">
                                        </div>
                                    </div>
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}gateway_block">
                                        <label for="{{ net_plane.name }}gateway" class="col-sm-4 control-label" style="text-align:right;">{% trans 'gateway' %}</label>
                                        <div class="col-sm-4">
                                            <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}gateway" type="text" class="form-control" id="{{ net_plane.name }}gateway" placeholder="{% trans 'gateway' %}" value="{{ net_plane.gateway|default_if_none:''}}">
                                        </div>
                                    </div>
                                    <div>
                                        <input id="{{ net_plane.name }}cluster_id" type="hidden" value="{{ net_plane.cluster_id }}">
                                        <input id="{{ net_plane.name }}countipranges" type="hidden" value="1">
                                        <input id="{{ net_plane.name }}netid" type="hidden" value="{{ net_plane.id }}">
                                        <input id="{{ net_plane.name }}network_type" type="hidden" value="{{ anet.network_type }}">
                                    </div>
                                    <div style="clear:both" class="{{ net_plane.name }}ip_ranges" id="{{ net_plane.name }}iprange_block">
                                        {% if net_plane.ip_ranges %}
                                        {% for iprange in net_plane.ip_ranges %}
                                        <div class="form-group ip_range" id="{{net_plane.name}}ip_range_index{{forloop.counter0}}">
                                            <label class="col-sm-4 control-label" style="text-align:right;">{% if forloop.first %}{% trans 'IP range' %}{% endif %}</label>
                                            <div class="col-sm-6">
                                                <div class="row">
                                                    <div class="col-xs-4">
                                                        <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_start" type="text" class="form-control ip_start" placeholder="{% trans 'IP starting address' %}" value="{{ iprange.start }}"/>
                                                    </div>
                                                    <div class="col-xs-1" style="text-align:center;">
                                                        <span class="glyphicon glyphicon-minus"></span>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_end" type="text" class="form-control ip_end" placeholder="{% trans 'IP ending address' %}" value="{{ iprange.end }}"/>
                                                    </div>
                                                    <div class="col-xs-3" style="">
                                                        <div class="row">
                                                            {% if forloop.first %}
                                                            {% ifequal anet.network_type "MANAGEMENT" %}
                                                            <a href="javascript:void(0);" title="{% trans 'Please reserve in advance HA floating IP, Glance of the role of a floating IP, role of LB and DB floating IP floating IP' %}">
                                                                <span class="glyphicon glyphicon-question-sign"></span>
                                                            </a>
                                                            {% endifequal %}
                                                            <a href="javascript:void(0);" class="{% ifequal net_plane.name 'physnet1' %}{{net_plane.name}}{% endifequal %}add_ip_range" net-name="{{ net_plane.name }}" data-name-start="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_start" data-name-end="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_end">
                                                                <span class="glyphicon glyphicon-plus"></span>
                                                            </a>
                                                            {% else %}
                                                            <a href="javascript:void(0);" net-name="{{ net_plane.name }}" data-name-start="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_start" data-name-end="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_end" class="delete_ip_range" delete_object="{{net_plane.name}}ip_range_index{{forloop.counter0}}"><span class="glyphicon glyphicon-minus"></span></a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="form-group ip_range" id="{{ net_plane.name }}ip_range_index0">
                                            <label class="col-sm-4 control-label" style="text-align:right;">{% trans 'IP range' %}</label>
                                            <div class="col-sm-6">
                                                <div class="row">
                                                    <div class="col-xs-4">
                                                        <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_start" type="text" class="form-control ip_start" placeholder="{% trans 'IP starting address' %}" value=""/>
                                                    </div>
                                                    <div class="col-xs-1" style="text-align:center;">
                                                        <span class="glyphicon glyphicon-minus"></span>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_end" type="text" class="form-control ip_end" placeholder="{% trans 'IP ending address' %}" value=""/>
                                                    </div>
                                                    <div class="col-xs-3" style="">
                                                        <div class="row">
                                                            {% ifequal anet.network_type "MANAGEMENT" %}
                                                            <a href="javascript:void(0);" title="{% trans 'Sets the automatically assigned a float IP, please reserve in advance the corresponding IP address' %}">
                                                                <span class="glyphicon glyphicon-question-sign"></span>
                                                            </a>
                                                            {% endifequal %}
                                                            <a href="javascript:void(0);" class="{% ifequal net_plane.name 'physnet1' %}{{net_plane.name}}{% endifequal %}add_ip_range" net-name="{{ net_plane.name }}" data-name-start="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_start" data-name-end="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}ip_end">
                                                                <span class="glyphicon glyphicon-plus"></span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif%}
                                        <!-- Template for dynamic field -->
                                        <div class="form-group" id="{{ net_plane.name }}template" style="display:none;clear:both;">
                                            <label class="col-sm-4 control-label" style="text-align:right;"></label>
                                            <div class="col-sm-6">
                                                <div class="row">
                                                    <div class="col-xs-4">
                                                        <input type="text" class="form-control ip_start" placeholder="{% trans 'IP starting address' %}" value=""/>
                                                    </div>
                                                    <div class="col-xs-1" style="text-align:center;">
                                                        <span class="glyphicon glyphicon-minus"></span>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <input type="text" class="form-control ip_end" placeholder="{% trans 'IP ending address' %}" value=""/>
                                                    </div>
                                                    <div class="col-xs-1" style="">
                                                        <div class="row">
                                                            <a href="javascript:void(0);" class="delete_dynamic_ip_range"><span class="glyphicon glyphicon-minus"></span></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}vlan_block">
                                        <label for="{{ net_plane.name }}vlan" class="col-sm-4 control-label" style="text-align:right;">{% trans 'VLAN' %}</label>
                                        <div class="col-sm-4">
                                            <input name="{% ifequal net_plane.type 'custom'%}{{net_plane.name}}{% endifequal %}vlan" type="text" class="form-control" id="{{ net_plane.name }}vlan" placeholder="{% trans 'VLAN' %}" value="{{ net_plane.vlan_id| default_if_none:'' }}">
                                        </div>
                                    </div>
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}vlanrange_block">
                                        <label for="{{ net_plane.name }}vlanstart" class="col-sm-4 control-label" style="text-align:right;">{% trans 'VLAN range' %}</label>
                                        <div class="col-sm-6">
                                            <div class="row">
                                                <div class="col-xs-4">
                                                    <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}vlanstart" type="text" class="form-control" id="{{ net_plane.name }}vlanstart" placeholder="{% trans 'VLAN starting number' %}" value="{{ net_plane.vlan_start }}"/>
                                                </div>
                                                <div class="col-xs-1" style="text-align:center;">
                                                    <span class="glyphicon glyphicon-minus"></span>
                                                </div>
                                                <div class="col-xs-4">
                                                    <input name="{% if net_plane.type == 'custom' or net_plane.name == 'physnet1'%}{{net_plane.name}}{% endif %}vlanend" type="text" class="form-control" id="{{ net_plane.name }}vlanend" placeholder="{% trans 'VLAN ending number' %}" value="{{ net_plane.vlan_end }}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="clear:both" class="form-group hide" id="{{ net_plane.name }}capability_block">
                                        <label for="{{ net_plane.name }}capability" class="col-sm-4 control-label" style="text-align:right;">{% trans 'capability' %}</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" name="capability" id="{{ net_plane.name }}capability">
                                                <option value="None" {% ifequal net_plane.capability "None"%}selected{% endifequal %}>{% trans 'Default' %}</option>
                                                <option value="high" {% ifequal net_plane.capability "high"%}selected{% endifequal %}>{% trans 'high' %}</option>
                                                <option value="low" {% ifequal net_plane.capability "low"%}selected{% endifequal %}>{% trans 'low' %}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="clear:both" class="form-group" id="{{ net_plane.name }}description_block">
                                        <label for="{{ net_plane.name }}description" class="col-sm-4 control-label" style="text-align:right;">{% trans 'description' %}</label>
                                        <div class="col-sm-4">
                                            <textarea class="form-control" id="{{ net_plane.name }}description" placeholder="{% trans 'description' %}" rows="3">{{ net_plane.description }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% ifequal net_plane.type "custom"%}
                            <script type="text/javascript" charset="utf-8">
                            $(function () {
                                AddNewField('{{net_plane.name}}');
                            });
                            </script>
                        {% endifequal %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="text-center">
        <input id="input-is-wizard" type="hidden" value="{{network.is_wizard}}">
        <input id="input-network-cluster-id" type="hidden" value="{{cluster_id}}">
    </div>
</form>

    <div id="modalAddNetPlane" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalAddNetPlaneLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal" data-dismiss="modal" aria-label="Close" onclick="CloseDialog()">&times;</a>
                    <h4 class="modal-title" id="modalAddNetPlaneLabel">{% trans "Add Net Plane" %}</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form_add_plane">
                        <div class="form-group">
                            <label for="txt_add_plane_name" class="col-sm-2 control-label">{% trans "Name" %}</label>
                            <div class='col-sm-8'>
                                <input name="add_plane_name" type="text" class="form-control" id="txt_add_plane_name" placeholder='{% trans "Name" %}'>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">{% trans "Type" %}</label>
                            <div class='col-sm-8'>
                                <select class="form-control" id="sel_add_plane_type" onchange="ShowParamByNetWorkType()">
                                    <!--<option value="PUBLIC">PUBLIC</option>
                                    <option value="MANAGEMENT">MANAGEMENT</option>-->
                                    <option value="STORAGE">STORAGE</option>
                                    <option value="DATAPLANE">DATAPLANE</option>
                                    <option value="HEARTBEAT">HEARTBEAT</option>
                                    <!--<option value="DEPLOYMENT">DEPLOYMENT</option>
                                    <option value="EXTERNAL">EXTERNAL</option>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group Optional STORAGE HEARTBEAT">
                            <label for="txt_add_plane_cidr" class="col-sm-2 control-label">{% trans "CIDR" %}</label>
                            <div class='col-sm-8'>
                                <input name="add_plane_cidr" type="text" class="form-control" id="txt_add_plane_cidr" placeholder='{% trans "CIDR" %}'>
                            </div>
                        </div>
                        <div class="form-group Optional STORAGE">
                            <label for="txt_add_plane_gateway" class="col-sm-2 control-label">{% trans "gateway" %}</label>
                            <div class='col-sm-8'>
                                <input name="add_plane_gateway" type="text" class="form-control" id="txt_add_plane_gateway" placeholder='{% trans "gateway" %}'>
                            </div>
                        </div>
                        <div class="form-group Optional STORAGE HEARTBEAT">
                            <label class="col-sm-2 control-label">{% trans 'IP range' %}</label>
                            <div class="col-sm-10">
                                <div class="row add_plane_ip_range">
                                    <div class="col-xs-5">
                                        <input name="add_plane_ip_start" type="text" class="form-control" placeholder="{% trans 'IP starting address' %}"/>
                                    </div>
                                    <div class="col-xs-1" style="height:34px;line-height:34px;text-align:center;">
                                        <span class="glyphicon glyphicon-minus"></span>
                                    </div>
                                    <div class="col-xs-5">
                                        <input name="add_plane_ip_end" type="text" class="form-control" placeholder="{% trans 'IP ending address' %}"/>
                                    </div>
                                    <div class="col-xs-1" style="height:34px;line-height:34px;">
                                        <a href="javascript:void(0);" class="add_plane_ip_range_link" data-name-start="add_plane_ip_start" data-name-end="add_plane_ip_end">
                                            <span class="glyphicon glyphicon-plus"></span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="add_plane_ip_range_template" style="display:none;">
                            <label class="col-sm-2 control-label"></label>
                            <div class="col-sm-10">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <input type="text" class="form-control" placeholder="{% trans 'IP starting address' %}" value=""/>
                                    </div>
                                    <div class="col-xs-1" style="height:34px;line-height:34px;text-align:center;">
                                        <span class="glyphicon glyphicon-minus"></span>
                                    </div>
                                    <div class="col-xs-5">
                                        <input type="text" class="form-control" placeholder="{% trans 'IP ending address' %}" value=""/>
                                    </div>
                                    <div class="col-xs-1" style="height:34px;line-height:34px;">
                                        <a href="javascript:void(0);" class="delete_add_plane_ip_range"><span class="glyphicon glyphicon-minus"></span></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group Optional STORAGE HEARTBEAT">
                            <label for="txt_add_plane_vlan" class="col-sm-2 control-label">{% trans 'VLAN' %}</label>
                            <div class="col-sm-8">
                                <input name="add_plane_vlan" type="text" class="form-control" id="txt_add_plane_vlan" placeholder="{% trans 'VLAN' %}">
                            </div>
                        </div>
                        <div class="form-group Optional DATAPLANE">
                            <label class="col-sm-2 control-label">{% trans 'VLAN range' %}</label>
                            <div class="col-sm-10">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <input name="add_plane_vlan_start" type="text" class="form-control" id="txt_add_plane_vlan_start" placeholder="{% trans 'VLAN starting number' %}">
                                    </div>
                                    <div class="col-xs-1" style="height:34px;line-height:34px;text-align:center;">
                                        <span class="glyphicon glyphicon-minus"></span>
                                    </div>
                                    <div class="col-xs-5">
                                        <input name="add_plane_vlan_end" type="text" class="form-control" id="txt_add_plane_vlan_end" placeholder="{% trans 'VLAN ending number' %}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group Optional">
                            <label for="sel_add_plane_capability" class="col-sm-2 control-label">{% trans 'capability' %}</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="capability" id="sel_add_plane_capability">
                                    <option value="high">{% trans 'high' %}</option>
                                    <option value="None">{% trans 'Default' %}</option>
                                    <option value="low">{% trans 'low' %}</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="txt_add_plane_desc" class="col-sm-2 control-label">{% trans "description" %}</label>
                            <div class='col-sm-8'>
                                <textarea name="add_plane_desc" class="form-control" rows="3" id="txt_add_plane_desc" placeholder="{% trans 'description' %}"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="AddNetPlane()">{% trans "Save"%}</button>
                    <button type="button" class="btn btn-default cancel" onclick="CloseDialog()">{% trans "Close" %}</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->